2007-06-18  Havoc Pennington  <hp@redhat.com>

	* dbus/dbus-watch.c (dbus_watch_get_socket)
	(dbus_watch_get_unix_fd): new API to match DBusConnection
	(dbus_watch_get_fd): deprecate this

	Throughout: just s/dbus_watch_get_fd/dbus_watch_get_socket/g for
	now since all the transports use sockets anyway
	
2007-06-16  Ralf Habacker  <ralf.habacker@freenet.de>

	* dbus/dbus-macros.h, dbus/dbus-message.c, 
	dbus/dbus-message.h: renamed DBUS_GNUC_DEPRECATED 
	to DBUS_DEPRECATED and extended to msvc compiler

2007-06-15  Ralf Habacker  <ralf.habacker@freenet.de>

	* cmake/CMakeLists.txt: use local include header first

	* dbus/dbus-sysdeps-win.c: mingw fix of DBusCredential struct

2007-06-15  Ralf Habacker  <ralf.habacker@freenet.de>

	* cmake/ConfigureChecks.cmake,cmake/config.h.cmake: 
	added check for HAVE_ERRNO_H

	* cmake/dbus/CMakeLists.txt: added missing files 
	
	* dbus/dbus-transport-win.c/.h: new files

	* dbus/dbus-sysdeps-win.c,.h: added required _unix functions 
	to make dbus compilable on win32 
	
	* dbus/dbus-sysdeps-win-utils.c,.h: moved some functions to 
	dbus-sysdeps-win.c
	
	* dbus-win.patch: removed applied or obsolate patches
	
	Note: dbus-win32 is now compilable, no guarantee that it runs 
	without any problems 

2007-06-15  Havoc Pennington  <hp@redhat.com>

	* dbus/dbus-sysdeps-unix.c (_dbus_append_session_config_file)
	(_dbus_append_system_config_file): new functions

	* bus/main.c (main): use _dbus_append_system_config_file() and 
	_dbus_append_session_config_file()

	* dbus/Makefile.am (INCLUDES): move DBUS_SYSTEM_CONFIG_FILE and
	DBUS_SESSION_CONFIG_FILE into this makefile

2007-06-15  Havoc Pennington  <hp@redhat.com>

	* dbus/dbus-sysdeps.c (_dbus_set_errno_to_zero)
	(_dbus_get_is_errno_nonzero, _dbus_get_is_errno_eintr)
	(_dbus_strerror_from_errno): family of functions to abstract
	errno, though these are somewhat bogus (really we should make our
	socket wrappers not use errno probably - the issue is that any
	usage of errno that isn't socket-related probably is not
	cross-platform, so should either be in a unix-only file that can
	use errno directly, or is a bug - these general errno wrappers
	hide issues of this nature in non-socket code, while
	socket-specific API changes would not since sockets are allowed
	cross-platform)

2007-06-14  Havoc Pennington  <hp@redhat.com>

	* bus/dispatch.c (check_get_connection_unix_process_id): mop up
	getpid() (noticed by Peter KKÃ¼mmel) and adapt the test to 
	expect a "pid unknown" error when running on Windows.

2007-06-14  Havoc Pennington  <hp@redhat.com>

	* dbus/dbus-sysdeps-unix.c (_dbus_credentials_parse_and_add_user):
	delete this function since it was effectively the same as
	_dbus_credentials_add_from_username()

2007-06-14  Havoc Pennington  <hp@redhat.com>

	* dbus/dbus-auth.c: adapt to keyring changes

	* dbus/dbus-keyring.c: change to avoid using user ID and home
	directory directly; instead use a
	keyring-location-from-credentials function in dbus-sysdeps

	* fix to use _dbus_append_user_from_current_process() instead of 
	_dbus_username_from_current_process() or _dbus_append_desired_identity().
	
2007-06-14  Ralf Habacker  <ralf.habacker@freenet.de>

	* reverted global rename of function _dbus_username_from_current_process. 
	It needs too much tests to verify that the change does not break anything. 
	I had overseen that the signatures are different and requires non
	trivial changes. 
	This is one *major* disadvantage of emulating oop functionality with c. 
	You are responsible for cleaning every object on every function return point
	which could be a nightmare if you are not working with dbus all the days.

2007-06-14  Ralf Habacker  <ralf.habacker@freenet.de>
    
	* dbus/dbus-auth.c (handle_client_initial_response_cookie_sha1_mech): 
	fixed usage of _dbus_append_desired_identity()

	* dbus/dbus-sysdeps.h (_dbus_username_from_current_process): removed prototype

2007-06-14  Ralf Habacker  <ralf.habacker@freenet.de>
    
	* dbus/dbus-sysdeps.c: moved global lock system_users from dbus-userdb.c

2007-06-14  Ralf Habacker  <ralf.habacker@freenet.de>
    
	* global rename of function _dbus_username_from_current_process
	to _dbus_append_desired_identity. 
	Approved by Havoc Pennington

2007-06-14  Ralf Habacker  <ralf.habacker@freenet.de>

	* dbus/dbus-sysdeps-win.c: disabled DBusUserInfo related code
		(_dbus_append_desired_identity,	_dbus_windows_user_is_process_owner):
    		new win32 functions as counterpart of unix related 
		(_dbus_send_credentials_socket,_dbus_read_credentials_socket): 
	    	renamed from ..._unix_socket
		(_dbus_send_credentials_unix_socket): removed obsolate function
	
	* dbus/dbus-sysdeps-win-util.c: disabled DBusGroupInfo related code
		(_dbus_verify_daemon_user,_dbus_change_to_daemon_user): 
		    new win32 functions as counterpart of unix related
	
2007-06-14  Simon McVittie  <simon.mcvittie@collabora.co.uk>

	* doc/dbus-specification.xml: say the protocol version is 1 instead of
	0 (patch from Kristoffer Lundén, fd.o#10033) and remove the FIXME
	about removing protocol version from messages (as per Havoc's comment
	on that bug)

2007-06-14  Ralf Habacker  <ralf.habacker@freenet.de>

	* dbus/dbus-sysdeps-win.c (_dbus_pid_for_log,_dbus_flush_caches): 
	new win32 functions as counterpart of unix related

2007-06-14  Ralf Habacker  <ralf.habacker@freenet.de>
	
	* cmake/modules/FindKDEWIN.cmake,
	  cmake/modules/FindKDEWIN_Packager.cmake, 
	  cmake/modules/Win32Macros.cmake: new files from the 
	  kdewin32 project
	* cmake/CMakeLists.txt: cleaned support for kdewin installer and 
	  win32 explorer wrapper

2007-06-13  Havoc Pennington  <hp@redhat.com>
	
	* dbus/dbus-message.c (dbus_message_iter_open_container): Fix
	broken return_if_fail (kind of scary that test suite does not
	cover this)

2007-06-13  Havoc Pennington  <hp@redhat.com>

	* dbus/dbus-server-socket.c (_dbus_server_listen_socket): support
	all_interfaces=true|false for tcp servers

	* dbus/dbus-sysdeps-unix.c (_dbus_listen_tcp_socket): support
	inaddr_any flag

	* bus/selinux.c: fix some missing includes

	* dbus/dbus-server-socket.c (_dbus_server_listen_socket): allow
	port to simply be omitted in addition to specifying 0

2007-06-13  Havoc Pennington  <hp@redhat.com>

	* configure.ac, bus/selinux.c, dbus/dbus-sysdeps-unix-util.c: add
	libaudit support, no clue what this means really but now we have
	it. Patches from Fedora package.

	* bus/bus.c (bus_context_new): move selinux initialization after
	changing to daemon user, patch from Fedora package

	* dbus/dbus-transport.c (auth_via_unix_user_function): fix a typo

2007-06-12  Havoc Pennington  <hp@redhat.com>

	* dbus/dbus-message.c (dbus_message_iter_open_container): improve
	the checks/warnings for contained_signature a bit

2007-06-12  Havoc Pennington  <hp@redhat.com>
	
	* dbus/dbus-marshal-recursive.c (write_or_verify_typecode):
	improve the warning a bit if you write extra data into a message

2007-06-12  Havoc Pennington  <hp@redhat.com>

	* dbus/dbus-auth.c (sha1_handle_second_client_response)
	(handle_server_data_anonymous_mech): add the process ID from
	socket credentials, if available, even if not using EXTERNAL

	* dbus/dbus-transport.c (auth_via_default_rules): support
	allow_anonymous flag

	* dbus/dbus-connection.c (dbus_connection_get_is_anonymous)
	(dbus_connection_set_allow_anonymous): new API for controlling
	anonymous access

2007-06-09  Havoc Pennington  <hp@redhat.com>

	* dbus/dbus-string.c (_dbus_string_pop_line): fix this not to
	think an empty line is the end of the file.
	Also, fix some whitespace.

	* dbus/dbus-string-util.c: add more tests for
	_dbus_string_pop_line() revealing that it thinks an empty line is
	the end of the file, which broke dbus-auth-script.c so 
	it didn't really run the scripts

	* dbus/dbus-auth.c: add ANONYMOUS mechanism

	* dbus/dbus-auth-script.c (_dbus_auth_script_run): fix to detect
	an empty/no-op auth script; add commands to check that we have or
	don't have the expected credentials	

2007-06-09  Havoc Pennington  <hp@redhat.com>

	* bus/policy.c (bus_policy_create_client_policy): gracefully
	continue if the connection has no unix user - just don't apply 
	any unix user dependent rules.

	* bus/config-parser.c: remove dbus-userdb.h usage

	* bus/bus.c: remove dbus-userdb.h usage

	* dbus/dbus-transport.c (_dbus_transport_get_is_authenticated):
	support Windows user function; also, fix the logic for checking
	auth as root in the default auth code (broken in the previous
	commit)

	* dbus/dbus-connection.c
	(dbus_connection_set_windows_user_function): new function
	(dbus_connection_get_windows_user): new function

2007-06-09  Havoc Pennington  <hp@redhat.com>

	* bus/dispatch.c (check_get_connection_unix_process_id): adapt
	since sysdeps-unix.h stuff isn't included anymore

	* bus/bus.c (bus_context_new): use more abstract functions to
	change user, so they can be no-ops on Windows

	* dbus/dbus-credentials.c, dbus/dbus-credentials.h,
	dbus/dbus-credentials-util.c: new files containing a fully opaque
	DBusCredentials data type to replace the old not opaque one.

	* configure.in (DBUS_UNIX): define DBUS_UNIX to match DBUS_WIN on
	windows

	* dbus/dbus-userdb.h: prohibit on Windows, next step is to clean
	up the uses of it in bus/*.c and factor out the parts of 
	cookie auth that depend on it
	
2007-06-07  Havoc Pennington  <hp@redhat.com>

	* dbus/dbus-message.c: improve some docs related to reading values
	from a message iter

2007-06-02  Ralf Habacker  <ralf.habacker@freenet.de>

	* cmake: added cygwin compile support

2007-06-01  Ralf Habacker  <ralf.habacker@freenet.de>

	* tools/dbus-launch-win.c: new file, replaces script wrapper on win32.

	* cmake/dbus-launch.bat.cmake: removed obsolate file

2007-05-31  Ralf Habacker  <ralf.habacker@freenet.de>

	* bus/main.c (main): uses _dbus_get_config_file_name() to detect 
	session.conf location on win32. 

	* dbus-sysdeps-win.h (_dbus_get_config_file_name,_dbus_file_exists): 
	new prototyp, undefined interface after including windows.h because 
	it makes trouble when a paramater is named interface.

	* dbus-sysdeps-win.c (_dbus_get_install_root,
	_dbus_get_config_file_name,_dbus_file_exists): 	new functions.

2007-05-27  Ralf Habacker  <ralf.habacker@freenet.de>

	* bus/policy.c,dbus/dbus-internals.c: fixed inconsistant line endings 
	as reported by Peter KÃ¼mmel.

2007-05-25  John (J5) Palmieri  <johnp@redhat.com>

	* Released 1.1.0

2007-05-25  John (J5) Palmieri  <johnp@redhat.com>

	* Split NEWS and ChangeLog into a .pre-1-0 file as per HACKING
	We forgot to do this during the 1.0 release and it makes sense
	now as we get ready to release the first 1.1.0 development tarball

2007-05-25  John (J5) Palmieri  <johnp@redhat.com>

	* create directory test/data/valid-config-files/session.d so that
	make check passes

2007-05-25  John (J5) Palmieri  <johnp@redhat.com>

	* INSTALL: remove dependancies for bindings since they no longer
	are a part of core

2007-05-25  Ralf Habacker  <ralf.habacker@freenet.de>

	* dbus/dbus-server-win.c,dbus/dbus-server-win.h: new file 
	with empty function _dbus_server_listen_platform_specific(). 

	* dbus/dbus-server.c (listen_funcs): uses 
	_dbus_server_listen_platform_specific on any platform.

2007-05-25  Ralf Habacker  <ralf.habacker@freenet.de>

	* dbus/dbus-sysdeps-win.c (fill_win_user_info_homedir): not getting 
	user info from a domain controller isn't an error, the computer 
	may run in a non domain context. 

2007-05-25  Ralf Habacker  <ralf.habacker@freenet.de>

	* dbus/dbus-sysdeps-win.c (_dbus_full_duplex_pipe): fixed assertation.

2007-05-24  Simon McVittie  <simon.mcvittie@collabora.co.uk>

	* bus/config-parser.c (test_service_dir_matches): fixed ordering for unix.

	* bus/config-parser.c (test_default_session_servicedirs): made allocation 
	of _progs platform independent.

2007-05-23  Havoc Pennington  <hp@redhat.com>

	* bus/Makefile.am (install-data-hook): create session.d

	* bus/session.conf.in: add session.d for the session bus, so
	security policy can be extended

2007-05-22 Ralf.Habacker <ralf.habacker@freenet.de>

	* cmake/CMakeLists.txt: fixed creating of TEST_..._BINARY to make 
	bus-test able to find the binaries.

2007-05-21 Simon McVittie  <simon.mcvittie@collabora.co.uk>

	* acinclude.m4, configure.in: In recent autotools, ${datadir} is
	defined in terms of ${datarootdir}, so EXPANDED_DATADIR needs to be
	expanded recursively. Rather than fixing configure.in to do this, I
	grabbed the AS_AC_EXPAND macro from autostars.sf.net, which seems to be
	commonly used.

2007-05-21 Simon McVittie  <simon.mcvittie@collabora.co.uk>

	* update-dbus-docs.sh: Assorted improvements:
	- Default user if $FDUSER is not set is the ssh default
	  (set in ~/.ssh/config or based on the local username), not a
	  hard-coded "johnp"
	- Temporary checkout directory is created securely (preventing symlink
	  attacks), if mktemp(1) is available
	- Use make -C rather than cd && make && cd ..

2007-05-21 Simon McVittie  <simon.mcvittie@collabora.co.uk>

	* HACKING: Point to correct mailing list

2007-05-21 Simon McVittie  <simon.mcvittie@collabora.co.uk>

	* doc/dbus-specification.xml: explicitly specify that STRING cannot
	contain embedded NULs.

2007-05-20 Ralf.Habacker  <ralf.habacker@freenet.de>

	* dbus/dbus-internal.c: fix inline problem on win32.

2007-05-20 Ralf.Habacker  <ralf.habacker@freenet.de>

	* dbus/dbus-sysdeps-win.c (fill_win_user_info_homedir): not reaching 
	domain controller isn't an error, converted error message to verbose 
	message.

2007-05-19 Ralf.Habacker  <ralf.habacker@freenet.de>

	* dbus/dbus-test.c (dbus_internal_do_not_use_run_tests): disabled 
	tests not running on wince.

2007-05-19 Ralf.Habacker  <ralf.habacker@freenet.de>

	* dbus/dbus-internals.c (_dbus_verbose_init): win32 requires 'varname=' 
	to unset a environment variable. 

2007-05-19 Ralf.Habacker  <ralf.habacker@freenet.de>

	* dbus/dbus-sysdeps.c (_dbus_setenv): win32 requires 'varname=' 
	to unset a environment variable. 

2007-05-19 Ralf.Habacker  <ralf.habacker@freenet.de>

	* bus/policy.c (bus_policy_create_client_policy): 
	win32 temporary fix until the userdb stuff is ported completly.

2007-05-19  Ralf.Habacker  <ralf.habacker@freenet.de>

	* dbus/dbus-server.c (listen_funcs): 
	_dbus_server_listen_platform_specific is empty on win32, 
	limited to unix only.

	* dbus/dbus-server.c (valid_addresses): limit unix 
	only addresses to unix. 

2007-05-18  Havoc Pennington  <hp@redhat.com>

	* doc/dbus-specification.xml: add a GetAll to the Properties
	interface.

2007-05-17 Ralf.Habacker  <ralf.habacker@freenet.de>
 
	* bus\config-parser.c (test_default_session_servicedirs):
	win32 fix.

2007-05-17 Ralf.Habacker  <ralf.habacker@freenet.de>
 
	* configure.in: define constant DBUS_UNIX.

2007-05-14  Ralf Habacker <ralf.habacker@freenet.de>

	* dbus/dbus-sysdeps-win.c (_dbus_printf_string_upper_bound):
	compile fix for MS Platform SDK 6 
	patch from Michael Luschas <mluschas@gmail.com>

2007-05-10  John (J5) Palmieri <johnp@redhat.com>

	* dbus-1.pc.in: add daemondir to pc file
	patch from Brian Cameron <brian.cameron at sun.com>

2007-05-04  Simon McVittie <simon.mcvittie@collabora.co.uk>

	* doc/dbus-specification.xml: mention the reserved o.fd.DBus.Local
	interface and the corresponding /o/fd/DBus/Local object path;
	describe them as reserved and forbid using them in a sent message,
	mentioning that in the reference implementation this will cause the
	connection to be dropped. Patch approved by Havoc.

2007-04-28  Ralf Habacker <ralf.habacker@freenet.de>

	* cmake/: don't install test applications and service files,
	moved CMAKE_DEBUG_POSTFIX to top level CMakeLists.txt

2007-04-27  Havoc Pennington  <hp@redhat.com>

	* dbus/dbus-sysdeps-unix.c (_dbus_open_socket): fix #10781 from
	Tobias Nygren, checking pointer to fd vs. 0 rather than checking
	the fd itself

2007-04-26 Ralf Habacker  <ralf.habacker@freenet.de>

	* cmake/: added debug postfixes to debug exe's for 
	easier debugging.
	* dbus\dbus-sysdeps-win.c (_dbus_win_set_error_from_win_error): 
	print error code in case no string message is available.

2007-04-06 Simon McVittie <simon.mcvittie@collabora.co.uk>

	* dbus/dbus-message-util.c, dbus/dbus-message.c,
	dbus/dbus-message.h: Add API to convert a DBusMessage to/from a
	byte array. Patch from Dafydd Harries <dafydd.harries@collabora.co.uk>,
	approved by Havoc Pennington.

2007-04-03  Timo Hoenig  <thoenig@suse.de>

	* dbus/dbus-address.c (dbus_parse_address): Do not accept zero-
	  length address.
	* dbus/dbus-address.c (_dbus_address_test): Add test for zero-
	  length address.

2007-03-25 Ralf.Habacker  <ralf.habacker@freenet.de>

	* cmake/dbus/CMakeLists.txt: debug postfix also for mingw.

2007-03-16 Ralf.Habacker  <ralf.habacker@freenet.de>

	* cmake/modules/FindExpat.cmake: fix package detection on win32.

	* README.win: update install instructions. 

2007-03-16 Ralf.Habacker  <ralf.habacker@freenet.de>

	* dbus/dbus-sysdeps.h (_dbus_split_paths_and_append):
	new prototyp
	(_DBUS_PATH_SEPARATOR): new macro. 

	* dbus/dbus-sysdeps.c (_dbus_split_paths_and_append): merged 
	from dbus/dbus-sysdeps-unix.c and dbus/dbus-sysdeps-win.c. 

2007-03-15 Ralf.Habacker  <ralf.habacker@freenet.de>

	* bus/config-parser.c, bus/policy.c,  
	bus/policy.h, bus/dbus-daemon.1.in,
	bus/session.conf.in: added eavesdrop support 
	for replies - patch by olli.salli at collabora.co.uk
	approved by Havoc Pennington. 

2007-03-15 Ralf.Habacker  <ralf.habacker@freenet.de>

	* dbus\dbus-sysdeps-win-thread.c: renamed to 
	dbus-sysdeps-thread-win.c, it is a platform depending file 
	similar	to dbus-sysdeps-pthread.c.

2007-03-15 Ralf.Habacker  <ralf.habacker@freenet.de>

	* cmake\doc\CMakeLists.txt: added prelimary xml doc 
	support, needs cmake Find script.

2007-03-14 Ralf.Habacker  <ralf.habacker@freenet.de>

	* cmake: add doxygen support

2007-03-14  Ralf.Habacker  <ralf.habacker@freenet.de>

	* cmake/config.h.cmake: WINCE fixes, defined DBUS_UNIX.

2007-03-13  Ralf.Habacker  <ralf.habacker@freenet.de>

	* dbus/dbus-sysdeps-util-win.c (dbus_become_daemon): 
	win32 compile fix. 

2007-03-13  Ralf.Habacker  <ralf.habacker@freenet.de>

	* dbus-win.patch: removed obsolate patches. 

2007-03-13  Ralf.Habacker  <ralf.habacker@freenet.de>

	* dbus/dbus-sysdeps-win.c: added zero byte sending 
	and receiving after connection start up

2007-03-11  Havoc Pennington  <hp@redhat.com>

	* tools/dbus-launch.c (do_close_stderr): fix C89 problem and
	formatting problem

	* Mostly fix the DBusPipe mess.
	- put line break after function return types
	- put space before parens
	- do not pass structs around by value
	- don't use dbus_strerror after calling supposedly cross-platform
	api
	- don't name pipe variables "fd"
	- abstract special fd numbers like -1 and 1

2007-03-12  Ralf Habacker  <ralf.habacker@freenet.de>

	* dbus/dbus-sysdeps-win.h, dbus/dbus-sysdeps-win.c, 
	dbus/dbus-sysdeps-util-win.c: renamed functions 
	_dbus_xxx_file() to _dbus_file_xxx() to reflect 
	struct name DBusFile. 

2007-03-12  Ralf Habacker  <ralf.habacker@freenet.de>

	* dbus/dbus-sysdeps-util-unix.c (_dbus_become_daemon):
	fix _dbus_pid_fd check. 

2007-03-10  Ralf Habacker  <ralf.habacker@freenet.de>

	* tools/dbus-print-message.c (print_message):
	added printing of the reply serial to method returns and 
	errors, so you can actually figure out the message/reply 
	pairs - patch by olli.salli at collabora.co.uk.

2007-03-10  Ralf Habacker  <ralf.habacker@freenet.de>

	* dbus-win.patch: removed committed patches. 

2007-03-10  Ralf Habacker  <ralf.habacker@freenet.de>

	* bus/bus.c, bus/bus.h, bus/main.c, bus/test.c,
	dbus/dbus-sysdeps-unix.c, dbus/dbus-sysdeps-util-unix.c,
	dbus/dbus-sysdeps-util-win.c, dbus/dbus-sysdeps-win.c,
	dbus/dbus-sysdeps.h: renamed _dbus_xxx_pipe to _dbus_pipe_xxx,
	completed _dbus_pipe support. 

2007-03-10  Ralf Habacker  <ralf.habacker@freenet.de>

	* dbus/dbus-sysdeps.h (_dbus_listen_tcp_socket):
	changed type or port to pointer, because the port is given back.

	* dbus/dbus-server-socket.c (_dbus_server_new_for_tcp_socket):
	implemented returning tcp port. Skipping port parameter
	and non integer port values in config <listen> statement
	needs more effort.

	* dbus/dbus-sysdeps-unix.c, dbus/dbus-sysdeps-win.c
	(_dbus_listen_tcp_socket): return the real used tcp port.

	* bus/dbus-daemon.1.in: added <listen> tcp examples

2007-03-09  Ralf Habacker  <ralf.habacker@freenet.de>

	* cmake/config.h.cmake: win32 msvc bug fix

2007-03-09  Ralf Habacker  <ralf.habacker@freenet.de>

	* cmake/config.h.cmake: fixed DBUS_WINxx defines,
	using _WINCE does not work.

2007-03-08  Ralf Habacker  <ralf.habacker@freenet.de>

	* dbus-win.patch: removed _dbus_write_pipe() patch, it is now 
	committed.

2007-03-08  Ralf Habacker  <ralf.habacker@freenet.de>

	* bus/bus.c, dbus/dbus-sysdeps-unix.c, dbus/dbus-sysdeps.h:
	rename pipe related write() function calls to _dbus_write_pipe().

2007-03-08  Ralf Habacker  <ralf.habacker@freenet.de>

	* dbus-win.patch: added bus/config-loader-libexpat.c patch, 
	uses DBUS_WIN for alls win32 related #ifdefs, 
	some minor cleanups

2007-03-08  Ralf Habacker  <ralf.habacker@freenet.de>

	* dbus-win.patch: updated patch for bus/dispatch.c.

2007-03-08  Ralf Habacker  <ralf.habacker@freenet.de>

	* dbus-win.patch: dbus-connection.c (dbus_connection_get_unix_user,
	dbus_connection_get_unix_process_id): Let return them valid user id's, 
	otherwise bus-test fails. How to replace on win32 ?.
	
	* dbus/dbus-sysdeps-win.c (fill_win_user_info_homedir):
	fix memory leak.

2007-03-08  Ralf Habacker  <ralf.habacker@freenet.de>

	* dbus/dbus-sysdeps-win.c (_dbus_win_set_error_from_win_error):
	use dbus friendly error name.
	(fill_win_user_info_homedir): print user name in error case too.

2007-03-08  Ralf Habacker  <ralf.habacker@freenet.de>

	* cmake/ConfigureChecks.cmake: fixed socketpair check

2007-03-08  Ralf Habacker  <ralf.habacker@freenet.de>

	* bus/dispatch.c: disabled segfault test on win32 for now

2007-03-08  Ralf Habacker  <ralf.habacker@freenet.de>

	* configure.in, cmake/ConfigureChecks.cmake: added check 
	for setrlimit. 
	* test/test-segfault.c: only include setrlimit stuff only 
	when available.  

2007-03-07  Ralf Habacker  <ralf.habacker@freenet.de>

	* test/test-segfault.c: unix compile fix.
	* dbus-win.patch: removed obsolate patches.

2007-03-07  Ralf Habacker  <ralf.habacker@freenet.de>

	* bus/activation.c: removed obsolate include header.
	* test/test-segfault.c: win32 compile fix, rlimit 
	isn't available on win32.
	* dbus-win.patch: removed some more patches, they
	are applied or obsolate 

2007-03-06  Ralf Habacker  <ralf.habacker@freenet.de>

	* bus-win.patch: fixes unix listen problems, dbus-test 
	now runs.

2007-03-06  Ralf Habacker  <ralf.habacker@freenet.de>

	* cmake/dbus/CMakeLists.txt,cmake/bus/CMakeLists.txt,
	cmake/CMakeLists.txt: win32 compile fix

2007-03-04  Ralf Habacker  <ralf.habacker@freenet.de>

	* dbus-win.patch, README.win: added available win32 
	patches from windbus project (http://sf.net/projects/windbus)

2007-03-04  Ralf Habacker  <ralf.habacker@freenet.de>

	* bus/activation.c: (bus_activation_activate_service):
	fixed call to _dbus_spawn_async_with_babysitter().

2007-03-04  Ralf Habacker  <ralf.habacker@freenet.de>

	* dbus/dbus-spawn.c,dbus/dbus-spawn.h (_dbus_spawn_async_with_babysitter):
	added environment pointer as function parameter, used on win32.

	* test/spawn-test.c: fixed call to above mentioned function.

2007-03-04  Ralf Habacker  <ralf.habacker@freenet.de>

	* configure.in,test/test-sleep-forever.c,test/test-names.c: 
	added configure check for unistd.h.

2007-03-04  Ralf Habacker  <ralf.habacker@freenet.de>

	* test/Makefile.am: fixed test data copy problem in 
	out of source build, when sources came from svn or cvs. 

2007-03-03  Ralf Habacker  <ralf.habacker@freenet.de>

	* dbus/*-win.*,bus/*-win.*: added win32 platform related
	files. These files are only added to the cmake build system.  
	The missing dbus-win.patch file will be added later. 

2007-03-03  Ralf Habacker  <ralf.habacker@freenet.de>

	* cmake: new directory, contains cmake build support.
	See http://www.cmake.org for more informations.
	Currently only unix will be buildable because some 
	win32 required files are still missing. 

2007-03-03  Thiago Macieira  <thiago@kde.org>

	* dbus/dbus-sysdeps-unix.c: capture the dbus-launch stderr
        output and add it to the DBusError message we return.

	* tools/dbus-launch.1:
	* tools/dbus-launch.c: Add option --close-stderr to, well,
	close stderr before starting dbus-daemon.

2007-01-31  Havoc Pennington  <hp@redhat.com>

	* bus/dbus-daemon.1.in: write a section in the man page on running
	a test daemon for debugging purposes

2007-01-26  Havoc Pennington  <hp@redhat.com>

	* bus/session.conf.in: override all the default limits with much
	higher limits on the session bus, there is no reason the session
	bus should have low limits

	* bus/config-parser.c (bus_config_parser_new): increase default
	limits so they are less likely to be hit; in particular the max
	replies per connection was way too low

2006-01-25  Simon McVittie  <simon.mcvittie@collabora.co.uk>

	* doc/dbus-tutorial.xml: Replace Python section of tutorial with
	a pointer to the tutorial maintained as part of dbus-python

2006-12-31  Ralf Habacker  <ralf.habacker@freenet.de>

	* dbus/dbus-sysdeps-unix.c: unix compile fix, moved 
	atomic_exchange_and_add() from dbus/dbus-sysdeps.c 
	to here, it's used by _dbus_atomic_inc() and _dbus_atomic_dec().

2006-12-31  Ralf Habacker  <ralf.habacker@freenet.de>

	* tools/dbus-monitor.c: gettimeofday() is not available 
	on windows so we have to provide our own. It's taken from 
	lgpl'd kdewin32 package. - Patches from Christian Ehrlicher

2006-12-31  Ralf Habacker  <ralf.habacker@freenet.de>

	* dbus/dbus-sysdeps-unix.c: moved _dbus_atomic_inc/dec() 
	from dbus/dbus-sysdeps.c, windows version of _dbus_atomic_inc/dec() 
	is in dbus-sysdeps-win.c (not in this patch).

	* dbus/dbus-sysdeps.h: DBusAtomic::value is long on windows to fit 
	with InterlockedInc/Decrement. 
	- Patches from Christian Ehrlicher
	
2006-12-31  Ralf Habacker  <ralf.habacker@freenet.de>

	* tools/dbus-send.c, tools/dbus-monitor.c: win32 compile fix.

2006-12-31  Ralf Habacker  <ralf.habacker@freenet.de>

	* dbus/dbus-marshal-recursive.c (type DBusTypeReaderClass):
	fix mispaced const statement. - Patch from Peter KÃ¼mmel

2006-12-19  Ray Strode  <rstrode@redhat.com>

	* bus/bus.c (process_config_every_time):
	don't overwrite existing bus context activation object
	until after we've checked that the new activation is
	valid.

	* bus/main.c 
	(signal_handler), (handle_reload_watch):
	don't call exit() on failure, instead make do and keep
	going.
	(close_reload_pipe): new function to turn off
	hangup-causes-config-reload behavior if an unexpected
	error occurs

2006-12-13  Ralf Habacker  <ralf.habacker@freenet.de>

	* dbus/dbus-sysdeps-win-thread.c (_dbus_condvar_wait_win32):
	correctness fix. - Patch from Christian Ehrlicher

2006-12-13  Ralf Habacker  <ralf.habacker@freenet.de>

	* dbus/dbus-internals.h: msvc also knows about __FUNCTION__, 
	we should also use it. - Patch from Christian Ehrlicher

2006-12-13  Ralf Habacker  <ralf.habacker@freenet.de>
  
	* dbus-sysdeps-util.c: added win32 related tests

2006-12-12  Ralf Habacker  <ralf.habacker@freenet.de>

	* dbus/dbus-string.c (_dbus_string_pop_line),
	bus/desktop-file.c (parse_section_start,
	parse_comment_or_blank,parse_key_value,): uses
	_dbus_string_find_eol() to support platform independent eol style.

2006-12-12  Ralf Habacker  <ralf.habacker@freenet.de>

	* dbus/dbus-string.[ch] (_dbus_string_find_eol): new function. 
	* dbus/dbus-string-util.c (_dbus_string_test): added testcases for 
	      _dbus_string_find_eol().
	Approved by: Havoc Pennington.

2006-12-12  Tim Dijkstra <tim@famdijkstra.org>

	* configure.in: Added switch to disable user_database caching.

	* dbus/dbus-userdb-util.c, dbus/dbus-userdb.c: Add ifdefs to
	be able disable user_dabase caching.

2006-12-12  Tim Dijkstra <tim@famdijkstra.org>

	* bus/bus.c, bus/bus.h: Remove DBusUserDatabase from the BusContext 
	struct. It is unnecessary we have a global one already. Also remove 
	bus_context_get_user_database function, it is no longer needed.
	Flush the global database on reload.

	* dbus/dbus-userdb-util.c: Replace _dbus_user_database_get_groups 
	with _dbus_groups_from_uid. It no longer needs a DBusUserDatabase.

	* dbus/dbus-userdb.c, dbus/dbus-userdb.h: 
	Add _dbus_user_database_flush_system. 
	Make more functions DBUS_USERDB_INCLUDES_PRIVATE. 
	Small unrelated change in _dbus_is_a_number: change 
	_dbus_string_parse_int to _dbus_string_parse_uint. 

	* bus/connection.c: Change call to _dbus_user_database_get_groups to 
	_dbus_groups_from_uid.

	* bus/policy.c, bus/policy.h: Change call to 
	_dbus_user_database_get_groups to _dbus_groups_from_uid. Remove 
	DBusUserDatabase from bus_policy_allow_user prototype, it no longer 
	needs it.

2006-12-12  John (J5) Palmieri  <johnp@redhat.com>

	* bus/signal.c: Fix match_rule_equal errata
	(CVE-2006-6107 - Patch from Kimmo HÃƒÂ¤mÃƒÂ¤lÃƒÂ¤inen 
	<kimmo.hamalainen@nokia.com>)

2006-11-19  Thiago Macieira  <thiago@kde.org>

	* dbus/dbus-sysdeps-pthread.c (_dbus_pthread_mutex_lock,
        _dbus_pthread_condvar_wait,
        _dbus_pthread_condvar_wait_timeout): set pmutex->holder to
        pthread_self() after coming back from a conditional variable
        wait as well as in one codepath where it was forgotten.
	Approved by: Havoc Pennington.

2006-11-17  Havoc Pennington  <hp@redhat.com>

	* update-dbus-docs.sh: allow setting fd.org username via env
	variable. Make it run autogen with --enable-xml-docs=yes
	--enable-doxygen-docs=yes so configure will fail if the required
	tools are missing.

2006-11-17  Havoc Pennington  <hp@redhat.com>

	* doc/dbus-faq.xml: minor FAQ tweaks

2006-11-14  Havoc Pennington  <hp@redhat.com>
	
	* dbus/dbus-misc.c, dbus/dbus-misc.h: Move
	dbus_get_local_machine_id() to its own file, no substantive
	changes. There are a couple other things we might want to add that
	are "misc" so moving out of dbus-connection.[hc] which is big
	enough already.
	
2006-11-14  Havoc Pennington  <hp@redhat.com>

	* dbus/dbus-internals.c (_dbus_generate_uuid): The spec said the
	UUID had the timestamp last, but the implementation had it first;
	move it to last since I think it's a tiny bit nicer (easier to
	compare at a glance, faster to sort, less code), and will not
	cause any practical compatibility problems. Also, always convert
	the timestamp to big endian.

	* doc/dbus-specification.xml: Clean up the docs on the UUID.

	* tools/dbus-uuidgen.1: more prominently say it is not suitable
	as a replacement for regular uuidgen/RFC4122.

2006-11-14  John (J5) Palmieri  <johnp@redhat.com>

	* dbus/dbus-threads.h: fix DBUS_THREAD_FUNCTIONS_ALL_MASK to have
	the correct value so we don't assert when initalizing recursive threads

	* test/name-test/test-thread-init.c: call dbus_threads_init_default
	instead of _dbus_threads_init_debug since it is more of a real world
	test

